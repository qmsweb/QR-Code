<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>تفاصيل المسلسل</title>
  <style>
    body {
      margin: 0;
      background: #111;
      color: #fff;
      font-family: sans-serif;
      overflow-x: hidden;
      direction: rtl;
    }

    header {
      position: fixed;
      top: 10px;
      right: 20px;
      z-index: 10;
    }

    header img {
      height: 50px;
    }

    #content {
      padding: 80px 5vw 40px;
    }

    .cover {
      width: 100%;
      max-width: 300px;
      height: auto;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .title {
      font-size: 2.2vw;
      margin-bottom: 10px;
      color: red;
    }

    .description {
      font-size: 1.2vw;
      margin-bottom: 30px;
      line-height: 1.6;
      max-width: 700px;
    }

    .episodes {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .episode {
      background: #333;
      padding: 10px 15px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s, transform 0.2s;
      border: 2px solid transparent;
    }

    .episode:hover,
    .episode.selected {
      background: #444;
      border-color: red;
      transform: scale(1.05);
    }

    @media (max-width: 768px) {
      .title {
        font-size: 20px;
      }

      .description {
        font-size: 14px;
      }

      .episode {
        font-size: 14px;
      }
    }
  </style>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>
  <header>
    <img src="https://raw.githubusercontent.com/qmsweb/Tools/main/images/one.png" alt="Logo">
  </header>

  <div id="content">
    <div id="series-info">
      <img id="cover" class="cover" src="" alt="غلاف المسلسل">
      <div class="title" id="title">جاري التحميل...</div>
      <div class="description" id="description"></div>
    </div>
    <div class="episodes" id="episodes"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDErdK7mjrXUtBYR28U7JIpbFi5RHWM9zM",
      authDomain: "momentschat.firebaseapp.com",
      databaseURL: "https://momentschat.firebaseio.com",
      projectId: "momentschat",
      storageBucket: "momentschat.appspot.com",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "1:866549697398:android:024dd3bf3b81d1adf78857"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    const coverEl = document.getElementById("cover");
    const titleEl = document.getElementById("title");
    const descriptionEl = document.getElementById("description");
    const episodesEl = document.getElementById("episodes");

    let currentIndex = 0;

    if (id) {
      db.ref("JTV_Cartoon/" + id).once("value").then(snapshot => {
        const data = snapshot.val();
        if (!data) {
          titleEl.textContent = "المحتوى غير موجود.";
          return;
        }

        coverEl.src = data.cover_URL || "";
        titleEl.textContent = data.title || "بدون عنوان";
        descriptionEl.textContent = data.description || "بدون وصف";

        if (data.episodes) {
          const episodes = Object.entries(data.episodes);
          episodes.forEach(([epId, epData], i) => {
            const ep = document.createElement("div");
            ep.className = "episode" + (i === 0 ? " selected" : "");
            ep.textContent = epData.title || `حلقة ${i + 1}`;
            ep.dataset.url = epData.url;
            ep.tabIndex = 0;
            episodesEl.appendChild(ep);
          });
        }
      });
    }

    document.addEventListener("keydown", (e) => {
      const eps = document.querySelectorAll(".episode");
      if (eps.length === 0) return;

      eps.forEach((ep, i) => ep.classList.remove("selected"));

      if (e.key === "ArrowLeft") {
        currentIndex = (currentIndex + 1) % eps.length;
      } else if (e.key === "ArrowRight") {
        currentIndex = (currentIndex - 1 + eps.length) % eps.length;
      } else if (e.key === "Enter") {
        const selected = eps[currentIndex];
        if (selected && selected.dataset.url) {
          window.location.href = selected.dataset.url;
        }
      }

      eps[currentIndex].classList.add("selected");
      eps[currentIndex].scrollIntoView({ behavior: "smooth", inline: "center" });
    });
  </script>
</body>
</html>
