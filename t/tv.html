<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>واجهة أفلام للريموت</title>
  <style>
    :root {
      --highlight-color: red;
    }
    * {
      box-sizing: border-box;
      user-select: none;
    }
    body {
      margin: 0;
      background: #111;
      color: #fff;
      font-family: sans-serif;
      overflow-y: auto;
      overflow-x: hidden;
      direction: rtl;
    }
    header {
      position: fixed;
      top: 10px;
      right: 20px;
      z-index: 10;
    }
    header img {
      height: 50px;
    }
    #app {
      padding-top: 70px;
    }
    .section {
      margin: 40px 0;
    }
    .section-title {
      margin: 10px 3vw;
      font-size: 2vw;
      color: #f0f0f0;
      text-align: right;
    }
    .carousel {
      display: flex;
      flex-direction: row;
      overflow-x: hidden;
      scroll-behavior: smooth;
      padding: 0 3vw;
      touch-action: none;
    }
    .movie {
      flex: 0 0 auto;
      width: 12vw;
      height: 18vw;
      background: #444;
      margin-left: 1vw;
      border: 3px solid transparent;
      transition: border 0.2s;
      border-radius: 6px;
      background-size: cover;
      background-position: center;
    }
    .movie.selected {
      border: 3px solid var(--highlight-color);
    }
    .section.selected .section-title {
      color: var(--highlight-color);
    }
    @media (max-width: 768px) {
      .movie {
        width: 30vw;
        height: 45vw;
      }
      .section-title {
        font-size: 18px;
      }
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>
  <header>
    <img src="https://raw.githubusercontent.com/qmsweb/Tools/main/images/one.png" alt="Logo">
  </header>
  <div id="app"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDErdK7mjrXUtBYR28U7JIpbFi5RHWM9zM",
      authDomain: "momentschat.firebaseapp.com",
      databaseURL: "https://momentschat.firebaseio.com",
      projectId: "momentschat",
      storageBucket: "momentschat.appspot.com",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "1:866549697398:android:024dd3bf3b81d1adf78857"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function loadVideos() {
      const app = document.getElementById('app');
      let sections = [];
      let currentSection = 0;
      let currentMovie = 0;

      // دائماً نحدث البيانات من Firebase عند تشغيل البرنامج
      const videosRef = db.ref("JTV_Cartoon").orderByKey();

      videosRef.once("value", (snapshot) => {
        const videos = snapshot.val();
        if (!videos) return;

        const categorized = {};
        for (let id in videos) {
          const video = videos[id];
          const cat = video.category || 'محتوى أصلي';
          if (!categorized[cat]) categorized[cat] = [];
          categorized[cat].push({ ...video, id });
        }

        localStorage.setItem('cachedVideos', JSON.stringify(categorized));
        buildUI(categorized);
      });

      function buildUI(categorized) {
        app.innerHTML = ''; // تنظيف الصفحة أولاً
        const categoryNames = Object.keys(categorized);
        categoryNames.forEach((catName, i) => {
          const section = document.createElement('div');
          section.className = 'section' + (i === 0 ? ' selected' : '');

          const title = document.createElement('div');
          title.className = 'section-title';
          title.textContent = catName;

          const carousel = document.createElement('div');
          carousel.className = 'carousel';

          categorized[catName].forEach((video, j) => {
            const movie = document.createElement('div');
            movie.className = 'movie' + (j === 0 && i === 0 ? ' selected' : '');
            movie.style.backgroundImage = `url(${video.cover_URL})`;
            movie.title = video.title || '';
            movie.dataset.id = video.id;

            movie.onclick = () => {
              window.location.href = `series.html?id=${video.id}`;
            };

            carousel.appendChild(movie);
          });

          section.appendChild(title);
          section.appendChild(carousel);
          app.appendChild(section);
          sections.push(section);
        });

        initNavigation(sections);
      }
    }

    function initNavigation(sections) {
      let currentSection = 0;
      let currentMovie = 0;

      function updateSelection() {
        sections.forEach((section, sIndex) => {
          section.classList.toggle('selected', sIndex === currentSection);
          const movies = section.querySelectorAll('.movie');
          movies.forEach((movie, mIndex) => {
            movie.classList.toggle('selected', sIndex === currentSection && mIndex === currentMovie);
          });
        });

        const carousel = sections[currentSection].querySelector('.carousel');
        const movies = carousel.querySelectorAll('.movie');
        const movie = movies[currentMovie];
        const offsetLeft = movie.offsetLeft - (carousel.clientWidth - movie.clientWidth) / 2;
        carousel.scrollTo({ left: offsetLeft, behavior: 'smooth' });
        sections[currentSection].scrollIntoView({ behavior: 'smooth', block: 'center' });
      }

      document.addEventListener('keydown', (e) => {
        if (['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Enter'].includes(e.key)) {
          e.preventDefault();
        }

        const currentCarousel = sections[currentSection].querySelector('.carousel');
        const movies = currentCarousel.querySelectorAll('.movie');

        if (e.key === 'ArrowLeft' && currentMovie < movies.length - 1) {
          currentMovie++;
          updateSelection();
        } else if (e.key === 'ArrowRight' && currentMovie > 0) {
          currentMovie--;
          updateSelection();
        } else if (e.key === 'ArrowDown' && currentSection < sections.length - 1) {
          currentSection++;
          currentMovie = 0;
          updateSelection();
        } else if (e.key === 'ArrowUp' && currentSection > 0) {
          currentSection--;
          currentMovie = 0;
          updateSelection();
        } else if (e.key === 'Enter') {
          const movie = movies[currentMovie];
          window.location.href = `series.html?id=${movie.dataset.id}`;
        }
      });

      updateSelection();
    }

    window.addEventListener("load", loadVideos);
  </script>
</body>
</html>
