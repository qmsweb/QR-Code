<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>واجهة أفلام للريموت</title>
  <style>
    :root {
      --highlight-color: #e50914;
      --primary-bg: #141414;
      --secondary-bg: #1f1f1f;
      --card-bg: #2a2a2a;
      --text-primary: #ffffff;
      --text-secondary: #b3b3b3;
      --transition-speed: 0.3s;
      --border-radius: 10px;
      --shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
    }
    
    * {
      box-sizing: border-box;
      user-select: none;
      margin: 0;
      padding: 0;
    }
    
    body {
      background: linear-gradient(135deg, var(--primary-bg) 0%, #0a0a0a 100%);
      color: var(--text-primary);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow-y: auto;
      overflow-x: hidden;
      direction: rtl;
      line-height: 1.6;
      min-height: 100vh;
    }
    
    /* تحسين الهيدر */
    header {
      position: fixed;
      top: 15px;
      right: 30px;
      z-index: 100;
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    header img {
      height: 55px;
      filter: drop-shadow(0 0 5px rgba(0,0,0,0.7));
      transition: transform 0.3s ease;
    }
    
    header img:hover {
      transform: scale(1.05);
    }
    
    .user-profile {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: linear-gradient(45deg, #ff416c, #ff4b2b);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      cursor: pointer;
      box-shadow: var(--shadow);
    }
    
    /* تحسين المحتوى الرئيسي */
    #app {
      padding-top: 90px;
      padding-bottom: 50px;
      max-width: 1800px;
      margin: 0 auto;
    }
    
    /* قسم المميز */
    .featured-section {
      margin: 30px 0 60px;
      padding: 0 3vw;
    }
    
    .featured-title {
      font-size: 2.5vw;
      margin-bottom: 20px;
      color: var(--text-primary);
      text-shadow: 0 2px 10px rgba(0,0,0,0.7);
      font-weight: 700;
      position: relative;
      padding-bottom: 10px;
    }
    
    .featured-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      right: 0;
      width: 100px;
      height: 4px;
      background: var(--highlight-color);
      border-radius: 2px;
    }
    
    .featured-carousel {
      display: flex;
      overflow-x: auto;
      scroll-behavior: smooth;
      scrollbar-width: none; /* Firefox */
      padding-bottom: 20px;
    }
    
    .featured-carousel::-webkit-scrollbar {
      display: none; /* Chrome, Safari, Opera */
    }
    
    .featured-movie {
      flex: 0 0 auto;
      width: 28vw;
      height: 15.75vw; /* 16:9 aspect ratio */
      background: var(--card-bg);
      margin-left: 1.5vw;
      border-radius: var(--border-radius);
      overflow: hidden;
      position: relative;
      transition: transform var(--transition-speed), box-shadow var(--transition-speed);
      box-shadow: var(--shadow);
      border: 2px solid transparent;
    }
    
    .featured-movie:first-child {
      margin-left: 0;
    }
    
    .featured-movie:hover {
      transform: translateY(-10px) scale(1.03);
      box-shadow: 0 15px 30px rgba(0,0,0,0.7);
      border-color: var(--highlight-color);
    }
    
    .featured-movie.selected {
      border: 2px solid var(--highlight-color);
      transform: translateY(-10px) scale(1.03);
    }
    
    .featured-movie img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform var(--transition-speed);
    }
    
    .featured-movie:hover img {
      transform: scale(1.05);
    }
    
    .movie-info {
      position: absolute;
      bottom: 0;
      right: 0;
      left: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 100%);
      padding: 20px 15px 15px;
      opacity: 0;
      transition: opacity var(--transition-speed);
    }
    
    .featured-movie:hover .movie-info {
      opacity: 1;
    }
    
    .movie-title {
      font-size: 1.3vw;
      font-weight: 700;
      margin-bottom: 8px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .movie-description {
      font-size: 0.9vw;
      color: var(--text-secondary);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    /* الأقسام العادية */
    .section {
      margin: 40px 0;
      position: relative;
    }
    
    .section-title {
      margin: 10px 3vw 20px;
      font-size: 1.8vw;
      color: var(--text-primary);
      text-align: right;
      font-weight: 700;
      position: relative;
      padding-bottom: 8px;
    }
    
    .section.selected .section-title {
      color: var(--highlight-color);
    }
    
    .section-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      right: 0;
      width: 50px;
      height: 3px;
      background: var(--highlight-color);
      border-radius: 2px;
      transition: width 0.3s ease;
    }
    
    .section:hover .section-title::after,
    .section.selected .section-title::after {
      width: 100px;
    }
    
    .carousel {
      display: flex;
      overflow-x: auto;
      scroll-behavior: smooth;
      scrollbar-width: none;
      padding: 0 3vw;
      position: relative;
    }
    
    .carousel::-webkit-scrollbar {
      display: none;
    }
    
    .movie {
      flex: 0 0 auto;
      width: 12vw;
      height: 18vw;
      background: var(--card-bg);
      margin-left: 1.5vw;
      border-radius: var(--border-radius);
      overflow: hidden;
      position: relative;
      transition: transform var(--transition-speed), box-shadow var(--transition-speed);
      box-shadow: var(--shadow);
      border: 2px solid transparent;
    }
    
    .movie:first-child {
      margin-left: 0;
    }
    
    .movie:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.5);
      border-color: rgba(229, 9, 20, 0.5);
    }
    
    .movie.selected {
      border: 2px solid var(--highlight-color);
      transform: translateY(-5px);
    }
    
    .movie img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    /* مؤشر التحميل */
    .loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      flex-direction: column;
      gap: 20px;
    }
    
    .spinner {
      width: 70px;
      height: 70px;
      border: 5px solid rgba(229, 9, 20, 0.3);
      border-radius: 50%;
      border-top-color: var(--highlight-color);
      animation: spin 1s linear infinite;
    }
    
    .loader-text {
      font-size: 1.5rem;
      color: var(--text-primary);
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* تحسينات للجوال */
    @media (max-width: 768px) {
      header {
        right: 15px;
        top: 10px;
      }
      
      header img {
        height: 40px;
      }
      
      .user-profile {
        width: 35px;
        height: 35px;
        font-size: 0.8rem;
      }
      
      #app {
        padding-top: 70px;
      }
      
      .featured-section {
        margin: 20px 0 40px;
      }
      
      .featured-title {
        font-size: 1.5rem;
        margin-bottom: 15px;
      }
      
      .featured-movie {
        width: 75vw;
        height: 42.2vw; /* 16:9 aspect ratio */
      }
      
      .movie-title {
        font-size: 1rem;
      }
      
      .movie-description {
        font-size: 0.8rem;
      }
      
      .section-title {
        font-size: 1.3rem;
        margin: 10px 5vw 15px;
      }
      
      .movie {
        width: 30vw;
        height: 45vw;
      }
    }
    
    @media (max-width: 480px) {
      .featured-movie {
        width: 85vw;
        height: 47.8vw;
      }
      
      .movie {
        width: 40vw;
        height: 60vw;
      }
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>
  <header>
    <img src="https://raw.githubusercontent.com/qmsweb/Tools/main/images/one.png" alt="Logo">
    <div class="user-profile">م</div>
  </header>
  
  <div id="app">
    <!-- سيتم ملؤه بواسطة الجافاسكريبت -->
  </div>
  
  <div class="loader">
    <div class="spinner"></div>
    <div class="loader-text">جاري تحميل الأفلام...</div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDErdK7mjrXUtBYR28U7JIpbFi5RHWM9zM",
      authDomain: "momentschat.firebaseapp.com",
      databaseURL: "https://momentschat.firebaseio.com",
      projectId: "momentschat",
      storageBucket: "momentschat.appspot.com",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "1:866549697398:android:024dd3bf3b81d1adf78857"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // تحسين كفاءة التحميل باستخدام localStorage
    function loadVideos() {
      const app = document.getElementById('app');
      const loader = document.querySelector('.loader');
      let sections = [];
      let currentSection = 0;
      let currentMovie = 0;
      let featuredCurrentMovie = 0;

      // التحقق من وجود بيانات في الكاش
      const cachedVideos = localStorage.getItem('cachedVideos');
      const cacheTimestamp = localStorage.getItem('cacheTimestamp');
      const oneHour = 60 * 60 * 1000; // ساعة واحدة بالميلي ثانية
      
      if (cachedVideos && cacheTimestamp && (Date.now() - parseInt(cacheTimestamp)) < oneHour) {
        // استخدام البيانات المخزنة مؤقتًا إذا كانت حديثة
        buildUI(JSON.parse(cachedVideos));
        initNavigation();
        loader.style.display = 'none';
      } else {
        // جلب البيانات من Firebase إذا لم تكن موجودة أو قديمة
        const videosRef = db.ref("JTV_Cartoon").orderByKey();
        
        videosRef.once("value", (snapshot) => {
          const videos = snapshot.val();
          if (!videos) {
            loader.style.display = 'none';
            return;
          }

          const categorized = {};
          for (let id in videos) {
            const video = videos[id];
            const cat = video.category || 'محتوى أصلي';
            if (!categorized[cat]) categorized[cat] = [];
            categorized[cat].push({ ...video, id });
          }

          // حفظ البيانات في localStorage مع الطابع الزمني
          localStorage.setItem('cachedVideos', JSON.stringify(categorized));
          localStorage.setItem('cacheTimestamp', Date.now().toString());
          
          buildUI(categorized);
          initNavigation();
          loader.style.display = 'none';
        }).catch((error) => {
          console.error("Error loading videos:", error);
          loader.style.display = 'none';
        });
      }

      function buildUI(categorized) {
        app.innerHTML = ''; // تنظيف الصفحة أولاً
        
        // إنشاء قسم المميز باستخدام بيانات القسم الأول
        const categoryNames = Object.keys(categorized);
        if (categoryNames.length > 0) {
          const firstCategory = categoryNames[0];
          createFeaturedSection(firstCategory, categorized[firstCategory]);
        }
        
        // إنشاء الأقسام العادية
        categoryNames.forEach((catName, i) => {
          createRegularSection(catName, categorized[catName], i);
        });
        
        sections = document.querySelectorAll('.section');
      }
      
      function createFeaturedSection(categoryName, videos) {
        const featuredSection = document.createElement('div');
        featuredSection.className = 'featured-section';
        
        const title = document.createElement('div');
        title.className = 'featured-title';
        title.textContent = categoryName;
        
        const carousel = document.createElement('div');
        carousel.className = 'featured-carousel';
        
        videos.forEach((video, j) => {
          const movie = document.createElement('div');
          movie.className = 'featured-movie' + (j === 0 ? ' selected' : '');
          
          const img = document.createElement('img');
          img.src = video.cover_URL || 'https://via.placeholder.com/400x225?text=No+Image';
          img.alt = video.title || '';
          
          const info = document.createElement('div');
          info.className = 'movie-info';
          
          const movieTitle = document.createElement('div');
          movieTitle.className = 'movie-title';
          movieTitle.textContent = video.title || 'بدون عنوان';
          
          const movieDesc = document.createElement('div');
          movieDesc.className = 'movie-description';
          movieDesc.textContent = video.description || 'لا يوجد وصف متوفر';
          
          info.appendChild(movieTitle);
          info.appendChild(movieDesc);
          
          movie.appendChild(img);
          movie.appendChild(info);
          movie.dataset.id = video.id;
          
          movie.onclick = () => {
            window.location.href = `series.html?id=${video.id}`;
          };
          
          carousel.appendChild(movie);
        });
        
        featuredSection.appendChild(title);
        featuredSection.appendChild(carousel);
        app.appendChild(featuredSection);
      }
      
      function createRegularSection(categoryName, videos, index) {
        const section = document.createElement('div');
        section.className = 'section' + (index === 0 ? ' selected' : '');
        
        const title = document.createElement('div');
        title.className = 'section-title';
        title.textContent = categoryName;
        
        const carousel = document.createElement('div');
        carousel.className = 'carousel';
        
        videos.forEach((video, j) => {
          const movie = document.createElement('div');
          movie.className = 'movie' + (j === 0 && index === 0 ? ' selected' : '');
          
          const img = document.createElement('img');
          img.src = video.cover_URL || 'https://via.placeholder.com/300x450?text=No+Image';
          img.alt = video.title || '';
          
          movie.appendChild(img);
          movie.dataset.id = video.id;
          
          movie.onclick = () => {
            window.location.href = `series.html?id=${video.id}`;
          };
          
          carousel.appendChild(movie);
        });
        
        section.appendChild(title);
        section.appendChild(carousel);
        app.appendChild(section);
      }
      
      function initNavigation() {
        let currentSection = 0;
        let currentMovie = 0;
        let featuredCurrentMovie = 0;
        const featuredMovies = document.querySelectorAll('.featured-movie');
        const sections = document.querySelectorAll('.section');
        
        function updateSelection() {
          // تحديد القسم المميز
          featuredMovies.forEach((movie, index) => {
            movie.classList.toggle('selected', index === featuredCurrentMovie);
          });
          
          // تحديد الأقسام العادية
          sections.forEach((section, sIndex) => {
            section.classList.toggle('selected', sIndex === currentSection);
            const movies = section.querySelectorAll('.movie');
            movies.forEach((movie, mIndex) => {
              movie.classList.toggle('selected', sIndex === currentSection && mIndex === currentMovie);
            });
          });
          
          // التمرير إلى العنصر المحدد
          if (sections.length > 0 && currentSection < sections.length) {
            const carousel = sections[currentSection].querySelector('.carousel');
            const movies = carousel.querySelectorAll('.movie');
            if (movies.length > 0 && currentMovie < movies.length) {
              const movie = movies[currentMovie];
              const offsetLeft = movie.offsetLeft - (carousel.clientWidth - movie.clientWidth) / 2;
              carousel.scrollTo({ left: offsetLeft, behavior: 'smooth' });
            }
            
            // التمرير إلى القسم في العرض
            sections[currentSection].scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        }
        
        document.addEventListener('keydown', (e) => {
          if (['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Enter'].includes(e.key)) {
            e.preventDefault();
          }
          
          // التنقل في القسم المميز
          if (featuredMovies.length > 0) {
            if (e.key === 'ArrowLeft' && featuredCurrentMovie < featuredMovies.length - 1) {
              featuredCurrentMovie++;
              updateSelection();
              return;
            } else if (e.key === 'ArrowRight' && featuredCurrentMovie > 0) {
              featuredCurrentMovie--;
              updateSelection();
              return;
            } else if (e.key === 'ArrowDown') {
              // الانتقال من القسم المميز إلى أول قسم عادي
              currentSection = 0;
              currentMovie = 0;
              updateSelection();
              return;
            } else if (e.key === 'Enter') {
              const movie = featuredMovies[featuredCurrentMovie];
              window.location.href = `series.html?id=${movie.dataset.id}`;
              return;
            }
          }
          
          // التنقل في الأقسام العادية
          if (sections.length > 0) {
            const currentCarousel = sections[currentSection].querySelector('.carousel');
            const movies = currentCarousel.querySelectorAll('.movie');
            
            if (e.key === 'ArrowLeft' && currentMovie < movies.length - 1) {
              currentMovie++;
              updateSelection();
            } else if (e.key === 'ArrowRight' && currentMovie > 0) {
              currentMovie--;
              updateSelection();
            } else if (e.key === 'ArrowDown' && currentSection < sections.length - 1) {
              currentSection++;
              currentMovie = 0;
              updateSelection();
            } else if (e.key === 'ArrowUp' && currentSection > 0) {
              currentSection--;
              currentMovie = 0;
              updateSelection();
            } else if (e.key === 'Enter') {
              const movie = movies[currentMovie];
              window.location.href = `series.html?id=${movie.dataset.id}`;
            }
          }
        });
        
        updateSelection();
      }
    }

    window.addEventListener("load", loadVideos);
  </script>
</body>
</html>
